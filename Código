#include <Servo.h>

// Objetos dos servos
Servo base;
Servo ombro;
Servo cotovelo;
Servo garra;

// Pinos dos joysticks
int joy1X = A0;
int joy1Y = A1;
int joy2X = A2;
int joy2Y = A3;

// Pinos dos servos
int pinBase = 10;
int pinOmbro = 11;
int pinCotovelo = 6;
int pinGarra = 9;

// Zona morta (ajuste conforme o joystick)
int deadZone = 100;

// Centros aproximados (calibrar com Serial Monitor!)
int centroBase = 512;
int centroOmbro = 512;
int centroCotovelo = 512;
int centroGarra = 512;

// Últimos ângulos estáveis
int angBase = 180;
int angOmbro = 180;
int angCotovelo = 180;
int angGarra = 90;

// ---- Função para ler joystick suavizado ----
int lerSuave(int pino) {
  long soma = 0;
  for (int i = 0; i < 10; i++) {
    soma += analogRead(pino);
    delay(1);
  }
  return soma / 10;
}

void setup() {
  base.attach(pinBase);
  ombro.attach(pinOmbro);
  cotovelo.attach(pinCotovelo);
  garra.attach(pinGarra);

  // Posição inicial
  base.write(angBase);
  ombro.write(angOmbro);
  cotovelo.write(angCotovelo);
  garra.write(angGarra);

  Serial.begin(9600);
}

void loop() {
  int valBase = lerSuave(joy1X);
  int valOmbro = lerSuave(joy1Y);
  int valCotovelo = lerSuave(joy2X);
  int valGarra = lerSuave(joy2Y);

  // Base
  if (abs(valBase - centroBase) > deadZone) {
    angBase = map(valBase, 0, 1023, 0, 180);
    base.write(angBase);
  }

  // Ombro
  if (abs(valOmbro - centroOmbro) > deadZone) {
    angOmbro = map(valOmbro, 0, 1023, 0, 180);
    ombro.write(angOmbro);
  }

  // Cotovelo
  if (abs(valCotovelo - centroCotovelo) > deadZone) {
    angCotovelo = map(valCotovelo, 0, 1023, 0, 180);
    cotovelo.write(angCotovelo);
  }

  // Garra
  if (abs(valGarra - centroGarra) > deadZone) {
    angGarra = map(valGarra, 0, 1023, 0, 180);
    garra.write(angGarra);
  }

  delay(5);
}
